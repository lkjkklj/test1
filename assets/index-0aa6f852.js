import{J as P,d as ee,r as m,R as de,e as s,o as g,v as C,w as t,g as e,h as u,f as D,q as R,F as E,C as T,m as O,j as K,K as L,t as ie,c as pe,Q as ce,N as me,y as _e,H as fe,A as Y,B as Z}from"./index-e296d5bf.js";const ge=(S,I,b)=>P.get(`/admin/product/${S}/${I}?category3Id=${b}`),le=()=>P.get("/admin/product/baseTrademark/getTrademarkList"),ae=S=>P.get("/admin/product/spuImageList/"+S),ue=S=>P.get("/admin/product/spuSaleAttrList/"+S),te=()=>P.get("/admin/product/baseSaleAttrList"),Se=S=>S.id?P.post("/admin/product/updateSpuInfo",S):P.post("/admin/product/saveSpuInfo",S),ye=S=>P.post("/admin/product/saveSkuInfo",S),ve=S=>P.get("/admin/product/findBySpuId/"+S),be=S=>P.delete("/admin/product/deleteSpu/"+S),Ve=["src"],ke=ee({__name:"spuForm",emits:["changeScene"],setup(S,{expose:I,emit:b}){const k=()=>{b("changeScene",{flag:0,params:"update"})};let x=m([]),V=m([]),A=m([]),r=m([]),w=m(!1),q=m(""),d=m({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),v=m("");const N=async l=>{d.value=l;let a=await le(),o=await ae(l.id),h=await ue(l.id),H=await te();x.value=a.data,V.value=o.data.map(z=>({name:z.imgName,url:z.imgUrl})),A.value=h.data,r.value=H.data},i=l=>{q.value=l.url,w.value=!0},p=l=>{console.log("aaa",l)},c=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<3?!0:(L({type:"error",message:"上传文件务必小于3M"}),!1):(L({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let U=de(()=>r.value.filter(a=>A.value.every(o=>a.name!=o.saleAttrName)));const $=()=>{const[l,a]=v.value.split(":");let o={baseSaleAttrId:l,saleAttrName:a,spuSaleAttrValueList:[]};A.value.push(o),v.value=""},B=l=>{l.flag=!0,l.saleAttrValue=""},_=l=>{const{baseSaleAttrId:a,saleAttrValue:o}=l;let h={baseSaleAttrId:a,saleAttrValueName:o};if(o.trim()==""){L({type:"error",message:"属性值不能为空的"});return}if(l.spuSaleAttrValueList.find(z=>z.saleAttrValueName==o)){L({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(h),l.flag=!1},f=async()=>{d.value.spuImageList=V.value.map(a=>({imgName:a.name,imgUrl:a.response&&a.response.data||a.url})),d.value.spuSaleAttrList=A.value,(await Se(d.value)).code==200?(L({type:"success",message:d.value.id?"更新成功":"添加成功"}),b("changeScene",{flag:0,params:d.value.id?"update":"add"})):L({type:"success",message:d.value.id?"更新成功":"添加成功"})};return I({initHasSpuData:N,initAddSpu:async l=>{Object.assign(d.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),V.value=[],A.value=[],v.value="",d.value.category3Id=l;let a=await le(),o=await te();x.value=a.data,r.value=o.data}}),(l,a)=>{const o=s("el-input"),h=s("el-form-item"),H=s("el-option"),z=s("el-select"),Q=s("Plus"),y=s("el-icon"),W=s("el-upload"),M=s("el-dialog"),j=s("el-button"),J=s("el-table-column"),ne=s("el-tag"),se=s("el-table"),oe=s("el-form");return g(),C(oe,{"label-width":"100px"},{default:t(()=>[e(h,{label:"SPU名称"},{default:t(()=>[e(o,{placeholder:"请你输入SPU名称",modelValue:u(d).spuName,"onUpdate:modelValue":a[0]||(a[0]=n=>u(d).spuName=n)},null,8,["modelValue"])]),_:1}),e(h,{label:"SPU品牌"},{default:t(()=>[e(z,{modelValue:u(d).tmId,"onUpdate:modelValue":a[1]||(a[1]=n=>u(d).tmId=n)},{default:t(()=>[(g(!0),D(E,null,R(u(x),n=>(g(),C(H,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"SPU描述"},{default:t(()=>[e(o,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:u(d).description,"onUpdate:modelValue":a[2]||(a[2]=n=>u(d).description=n)},null,8,["modelValue"])]),_:1}),e(h,{label:"SPU图片"},{default:t(()=>[e(W,{"file-list":u(V),"onUpdate:fileList":a[3]||(a[3]=n=>T(V)?V.value=n:V=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":i,"on-remove":p,"before-upload":c},{default:t(()=>[e(y,null,{default:t(()=>[e(Q)]),_:1})]),_:1},8,["file-list"]),e(M,{modelValue:u(w),"onUpdate:modelValue":a[4]||(a[4]=n=>T(w)?w.value=n:w=n)},{default:t(()=>[O("img",{"w-full":"",src:u(q),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Ve)]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"SPU销售属性"},{default:t(()=>[e(z,{modelValue:u(v),"onUpdate:modelValue":a[5]||(a[5]=n=>T(v)?v.value=n:v=n),placeholder:u(U).length?`还未选择${u(U).length}个`:"无"},{default:t(()=>[(g(!0),D(E,null,R(u(U),(n,X)=>(g(),C(H,{value:`${n.id}:${n.name}`,key:n.id,label:n.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"]),e(j,{onClick:$,disabled:!u(v),style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus"},{default:t(()=>[K(" 添加属性 ")]),_:1},8,["disabled"]),e(se,{border:"",style:{margin:"10px 0px"},data:u(A)},{default:t(()=>[e(J,{label:"序号",type:"index",align:"center",width:"80px"}),e(J,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(J,{label:"销售属性值"},{default:t(({row:n,$index:X})=>[(g(!0),D(E,null,R(n.spuSaleAttrValueList,(F,re)=>(g(),C(ne,{style:{margin:"0px 5px"},onClose:he=>n.spuSaleAttrValueList.splice(re,1),key:n.id,class:"mx-1",closable:""},{default:t(()=>[K(ie(F.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.flag==!0?(g(),C(o,{key:0,onBlur:F=>_(n),modelValue:n.saleAttrValue,"onUpdate:modelValue":F=>n.saleAttrValue=F,placeholder:"请你输入属性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(g(),C(j,{key:1,onClick:F=>B(n),type:"primary",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(J,{label:"操作",width:"120px"},{default:t(({row:n,$index:X})=>[e(j,{type:"primary",size:"small",icon:"Delete",onClick:F=>u(A).splice(X,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(h,null,{default:t(()=>[e(j,{disabled:!(u(A).length>0),type:"primary",size:"default",onClick:f},{default:t(()=>[K(" 保存 ")]),_:1},8,["disabled"]),e(j,{type:"primary",size:"default",onClick:k},{default:t(()=>[K("取消")]),_:1})]),_:1})]),_:1})}}}),Ae=["src"],Ie=ee({__name:"skuForm",emits:["changeScene"],setup(S,{expose:I,emit:b}){let k=m([]),x=m([]),V=m([]),A=m(),r=pe({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const w=async(N,i,p)=>{r.category3Id=p.category3Id,r.spuId=p.id,r.tmId=p.tmId;let c=await ce(N,i,p.category3Id),U=await ue(p.id),$=await ae(p.id);k.value=c.data,x.value=U.data,V.value=$.data},q=()=>{b("changeScene",{flag:0,params:""})},d=N=>{V.value.forEach(i=>{A.value.toggleRowSelection(i,!1)}),A.value.toggleRowSelection(N,!0),r.skuDefaultImg=N.imgUrl};I({initSkuData:w});const v=async()=>{r.skuAttrValueList=k.value.reduce((i,p)=>{if(p.attrIdAndValueId){let[c,U]=p.attrIdAndValueId.split(":");i.push({attrId:c,valueId:U})}return i},[]),r.skuSaleAttrValueList=x.value.reduce((i,p)=>{if(p.saleIdAndValueId){let[c,U]=p.saleIdAndValueId.split(":");i.push({saleAttrId:c,saleAttrValueId:U})}return i},[]),(await ye(r)).code==200?(L({type:"success",message:"添加SKU成功"}),b("changeScene",{flag:0,params:""})):L({type:"error",message:"添加SKU失败"})};return(N,i)=>{const p=s("el-input"),c=s("el-form-item"),U=s("el-option"),$=s("el-select"),B=s("el-form"),_=s("el-table-column"),f=s("el-button"),G=s("el-table");return g(),C(B,{"label-width":"100px"},{default:t(()=>[e(c,{label:"SKU名称"},{default:t(()=>[e(p,{placeholder:"SKU名称",modelValue:u(r).skuName,"onUpdate:modelValue":i[0]||(i[0]=l=>u(r).skuName=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"价格(元)"},{default:t(()=>[e(p,{placeholder:"价格(元)",type:"number",modelValue:u(r).price,"onUpdate:modelValue":i[1]||(i[1]=l=>u(r).price=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"重量(g)"},{default:t(()=>[e(p,{placeholder:"重量(g)",type:"number",modelValue:u(r).weight,"onUpdate:modelValue":i[2]||(i[2]=l=>u(r).weight=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"SKU描述"},{default:t(()=>[e(p,{placeholder:"SKU描述",type:"textarea",modelValue:u(r).skuDesc,"onUpdate:modelValue":i[3]||(i[3]=l=>u(r).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"平台属性"},{default:t(()=>[e(B,{inline:!0},{default:t(()=>[(g(!0),D(E,null,R(u(k),l=>(g(),C(c,{key:l.id,label:l.attrName},{default:t(()=>[e($,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":a=>l.attrIdAndValueId=a},{default:t(()=>[(g(!0),D(E,null,R(l.attrValueList,a=>(g(),C(U,{value:`${l.id}:${a.id}`,key:a.id,label:a.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(c,{label:"销售属性"},{default:t(()=>[e(B,{inline:!0},{default:t(()=>[(g(!0),D(E,null,R(u(x),(l,a)=>(g(),C(c,{label:l.saleAttrName,key:l.id},{default:t(()=>[e($,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":o=>l.saleIdAndValueId=o},{default:t(()=>[(g(!0),D(E,null,R(l.spuSaleAttrValueList,(o,h)=>(g(),C(U,{value:`${l.id}:${o.id}`,key:o.id,label:o.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(c,{label:"图片名称"},{default:t(()=>[e(G,{border:"",data:u(V),ref_key:"table",ref:A},{default:t(()=>[e(_,{type:"selection",width:"80px",align:"center"}),e(_,{label:"图片"},{default:t(({row:l,$index:a})=>[O("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,Ae)]),_:1}),e(_,{label:"名称",prop:"imgName"}),e(_,{label:"操作"},{default:t(({row:l,$index:a})=>[e(f,{type:"primary",size:"small",onClick:o=>d(l)},{default:t(()=>[K(" 设置默认 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(c,null,{default:t(()=>[e(f,{type:"primary",size:"default",onClick:v},{default:t(()=>[K("保存")]),_:1}),e(f,{type:"primary",size:"default",onClick:q},{default:t(()=>[K("取消")]),_:1})]),_:1})]),_:1})}}}),Ue=["src"],Ce=ee({__name:"index",setup(S){let I=me(),b=m(0),k=m(1),x=m(3),V=m([]),A=m(0),r=m(),w=m(),q=m([]),d=m(!1);_e(()=>I.c3Id,()=>{V.value=[],I.c3Id&&v()});const v=async(_=1)=>{k.value=_;let f=await ge(k.value,x.value,I.c3Id);f.code==200&&(V.value=f.data.records,A.value=f.data.total)},N=()=>{v()},i=()=>{b.value=1,r.value.initAddSpu(I.c3Id)},p=_=>{b.value=1,r.value.initHasSpuData(_)},c=_=>{b.value=_.flag,_.params=="update"?v(k.value):v()},U=_=>{b.value=2,w.value.initSkuData(I.c1Id,I.c2Id,_)},$=async _=>{let f=await ve(_.id);f.code==200&&(q.value=f.data,d.value=!0)},B=async _=>{(await be(_.id)).code==200?(L({type:"success",message:"删除成功"}),v(V.value.length>1?k.value:k.value-1)):L({type:"error",message:"删除失败"})};return fe(()=>{I.$reset()}),(_,f)=>{const G=s("Category"),l=s("el-button"),a=s("el-table-column"),o=s("el-popconfirm"),h=s("el-table"),H=s("el-pagination"),z=s("el-dialog"),Q=s("el-card");return g(),D("div",null,[e(G,{scene:u(b)},null,8,["scene"]),e(Q,{style:{margin:"10px 0px"}},{default:t(()=>[Y(O("div",null,[e(l,{onClick:i,type:"primary",size:"default",icon:"Plus",disabled:!u(I).c3Id},{default:t(()=>[K(" 添加SPU ")]),_:1},8,["disabled"]),e(h,{style:{margin:"10px 0px"},border:"",data:u(V)},{default:t(()=>[e(a,{label:"序号",type:"index",align:"center",width:"80px"}),e(a,{label:"SPU名称",prop:"spuName"}),e(a,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(a,{label:"SPU操作"},{default:t(({row:y,$index:W})=>[e(l,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:M=>U(y)},null,8,["onClick"]),e(l,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:M=>p(y)},null,8,["onClick"]),e(l,{type:"primary",size:"small",icon:"View",title:"查看SKU列表",onClick:M=>$(y)},null,8,["onClick"]),e(o,{title:`你确定删除${y.spuName}?`,width:"200px",onConfirm:M=>B(y)},{reference:t(()=>[e(l,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(H,{"current-page":u(k),"onUpdate:currentPage":f[0]||(f[0]=y=>T(k)?k.value=y:k=y),"page-size":u(x),"onUpdate:pageSize":f[1]||(f[1]=y=>T(x)?x.value=y:x=y),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:u(A),onCurrentChange:v,onSizeChange:N},null,8,["current-page","page-size","total"])],512),[[Z,u(b)==0]]),Y(e(ke,{ref_key:"spu",ref:r,onChangeScene:c},null,512),[[Z,u(b)==1]]),Y(e(Ie,{ref_key:"sku",ref:w,onChangeScene:c},null,512),[[Z,u(b)==2]]),e(z,{modelValue:u(d),"onUpdate:modelValue":f[2]||(f[2]=y=>T(d)?d.value=y:d=y),title:"SKU列表"},{default:t(()=>[e(h,{border:"",data:u(q)},{default:t(()=>[e(a,{label:"SKU名字",prop:"skuName"}),e(a,{label:"SKU价格",prop:"price"}),e(a,{label:"SKU重量",prop:"weight"}),e(a,{label:"SKU图片"},{default:t(({row:y,$index:W})=>[O("img",{src:y.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Ue)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{Ce as default};
